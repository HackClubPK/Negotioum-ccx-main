<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In</title>
</head>
<body>

    <h1>Sign In</h1>
    <div id="errorbox"></div>
    <form id="signInForm">
        <label for="teamName">Team Name:</label>
        <input type="text" id="teamName" name="teamName" required>

        <br>

        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required>

        <br>

        <button type="button" onclick="signIn(event)">Sign In</button>
    </form>
    <script>
        async function signIn(event) {
            event.preventDefault();
            const Uteamname = document.getElementById('teamName').value;
            const Upassword = document.getElementById('password').value;

            if (!Uteamname || !Upassword) {
                document.getElementById('errorbox').innerText = "Please enter the values in.";
            } else {
                try {
                    const response = await fetch(`/.netlify/functions/read?teamName=${Uteamname}`);

                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }

                    const data = await response.json();

                    if (data.error) {
                        document.getElementById("status").innerText = `Error: ${data.error}`;
                    } else {
                        const Spassword = data.Team_password;

                        if (Spassword === Upassword) {
                            // Redirect to index.js or another page on the server side
                            window.location.href = 'https://scintillating-crostata-c432a0.netlify.app/user.html'; // Adjust the URL as needed
                        } else {
                            document.getElementById('errorbox').innerText = "Password Wrong";
                        }
                    }
                } catch (error) {
                    document.getElementById('errorbox').innerText = "An error occurred during sign-in.";
                }
            }
        }

    </script>
    <script src="./login.js"></script>
</body>
</html>
